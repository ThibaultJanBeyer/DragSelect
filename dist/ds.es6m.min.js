function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function l(t,e,i){return(l=a()?Reflect.construct:function(t,e,i){var n=[null];n.push.apply(n,e);var r=new(Function.bind.apply(t,n));return i&&o(r,i.prototype),r}).apply(null,arguments)}function c(t){var e="function"==typeof Map?new Map:void 0;return(c=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return l(t,arguments,s(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,t)})(t)}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?u(t):e}function h(t){var e=a();return function(){var i,n=s(t);if(e){var r=s(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return d(this,i)}}function f(t,e,i){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function v(t){return function(t){if(Array.isArray(t))return S(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return S(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return S(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var m=function(t,e,i){var n=t.x,r=t.y,s=i.x,o=i.y;return{"+":{x:n+s,y:r+o},"-":{x:n-s,y:r-o},"*":{x:n*s,y:r*o},"/":{x:n/s,y:r/o}}[e]},p=function(t){return{x:t.left,y:t.top}},g=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{left:t.x,top:t.y,right:t.x,bottom:t.y,width:e,height:e}},y=function(){var t,e,i,n;return{y:(null===(t=document.body)||void 0===t?void 0:t.scrollTop)||(null===(e=document.documentElement)||void 0===e?void 0:e.scrollTop)||0,x:(null===(i=document.body)||void 0===i?void 0:i.scrollLeft)||(null===(n=document.documentElement)||void 0===n?void 0:n.scrollLeft)||0}},b=function(t){return!t||t instanceof Document?y():{x:t.scrollLeft>=0?t.scrollLeft:y().x,y:t.scrollTop>=0?t.scrollTop:y().y}},_=function(t){var e=t.elementRect,i=t.containerRect,n=t.tolerance,r=void 0===n?{x:0,y:0}:n,s=[];return e.top-r.y<i.top&&s.push("top"),e.left-r.x<i.left&&s.push("left"),e.bottom+r.y>i.bottom&&s.push("bottom"),e.right+r.y>i.right&&s.push("right"),s},D=function(t){var e=t.event;return{x:e.clientX,y:e.clientY}},k=function(t){var e={x:0,y:0},i=window.getComputedStyle(t);if(!i.transform||"none"===i.transform)return e;if(i.transform.indexOf("3d")>=0){var n=i.transform.trim().match(/matrix3d\((.*?)\)/);if(n&&n.length){var r,s=null===(r=n[1])||void 0===r?void 0:r.split(",");e.x=parseInt(s[12])||0,e.y=parseInt(s[13])||0}return e}var o=i.transform.trim().match(/matrix\((.*?)\)/);if(o&&o.length){var a,l=null===(a=o[1])||void 0===a?void 0:a.split(",");e.x=parseInt(l[4])||0,e.y=parseInt(l[5])||0}return e},x=function(t,e){return e?function(t){var e=t.style.transform;if(!e||e.indexOf("translate")<0)return k(t);var i={x:0,y:0},n=e.trim().match(/translate[3dD]*?\(.*?\)/);if(n){var r,s=null===(r=n[0])||void 0===r?void 0:r.split("(");if(s){var o,a=null===(o=s[1])||void 0===o?void 0:o.split(",");i.x=parseInt(a[0])||0,i.y=parseInt(a[1])||0}}return i.x||i.x?i:k(t)}(t):function(t){var e=t.style,i={x:parseInt(e.left)||0,y:parseInt(e.top)||0};if(!i.x&&!i.x){var n=window.getComputedStyle(t);return{x:parseInt(n.left)||0,y:parseInt(n.top)||0}}return i}(t)},E=function(t,e){return t.left<e.right&&t.right>e.left&&t.top<e.bottom&&t.bottom>e.top},w=function(t){var e=t.element,i=t.posDirection,n=t.containerRect,r=t.useTransform,s=x(e,r),o=m(s,"+",i);I(e,o,r);var a=e.getBoundingClientRect();!function(t){var e=t.element,i=t.edges,n=t.elementRect,r=t.containerRect,s=t.elementPos,o=t.useTransform;i.includes("top")&&I(e,{y:s.y+r.top-n.top,x:s.x},o),i.includes("left")&&I(e,{y:s.y,x:s.x+r.left-n.left},o),i.includes("bottom")&&I(e,{y:s.y+r.bottom-n.bottom,x:s.x},o),i.includes("right")&&I(e,{y:s.y,x:s.x+r.right-n.right},o)}({element:e,edges:_({elementRect:a,containerRect:n}),elementRect:a,containerRect:n,elementPos:o,useTransform:r})},I=function(t,e,i){if(i){var n=t.style.transform;t.style.transform="translate3d(".concat(e.x,"px,").concat(e.y,"px,1px) ").concat(n.replace(/translate.*?\)/g,""))}else t.style.left="".concat(e.x,"px"),t.style.top="".concat(e.y,"px");return t},A=function(t){return t?!Array.isArray(t)&&(t instanceof HTMLElement||t instanceof SVGElement)?[t]:v(t):[]},P=function(t,e){t.style.left="".concat(e.left,"px"),t.style.top="".concat(e.top,"px"),t.style.width="".concat(e.width,"px"),t.style.height="".concat(e.height,"px")},L=function(){function e(i){var r=this,s=i.area,o=i.PS,a=i.zoom;t(this,e),n(this,"_modificationCallback",void 0),n(this,"_modificationObserver",void 0),n(this,"_zoom",void 0),n(this,"_node",void 0),n(this,"_parentNodes",void 0),n(this,"_computedStyle",void 0),n(this,"_computedBorder",void 0),n(this,"_rect",void 0),n(this,"start",(function(){var t,e,i;t=r.parentNodes,e=r._modificationCallback,i=r._modificationObserver,window.addEventListener("resize",e),window.addEventListener("scroll",e),t.forEach((function(t,e){i.observe(t,{childList:0!==e,attributes:!0})}))})),n(this,"reset",(function(){r._computedStyle=void 0,r._rect=void 0,r._computedBorder=void 0,r._parentNodes=void 0})),n(this,"stop",(function(){var t,e;t=r._modificationObserver,e=r._modificationCallback,window.removeEventListener("resize",e),window.removeEventListener("scroll",e),t.disconnect(),r.reset()})),n(this,"scroll",(function(t,e){!function(t,e,i){if(e.length){var n=document&&document.documentElement&&document.documentElement.scrollTop&&document.documentElement,r=t instanceof HTMLDocument?n||document.body:t,s=e.includes("top")&&r.scrollTop>0,o=e.includes("bottom")&&r.scrollTop<r.scrollHeight,a=e.includes("left")&&r.scrollLeft>0,l=e.includes("right")&&r.scrollLeft<r.scrollWidth;s&&(r.scrollTop-=1*i),o&&(r.scrollTop+=1*i),a&&(r.scrollLeft-=1*i),l&&(r.scrollLeft+=1*i)}}(r._node,t,e),r.PubSub.publish("Area:scroll",{data:{directions:t,multiplier:e}})})),this._node=s,this._zoom=a,this.PubSub=o;var l,c,u,d=this.computedStyle.position,h="absolute"===d||"relative"===d||"fixed"===d;this._node instanceof HTMLDocument||h||(this._node.style.position="relative"),this._modificationCallback=(l=function(t){r.reset(),r.PubSub.publish("Area:modified",{event:t,item:r})},c=60,function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=function(){u=null,l.apply(void 0,e)};clearTimeout(u),u=setTimeout(n,c)}),this._modificationObserver=new MutationObserver(this._modificationCallback),setTimeout((function(){r.reset(),r.PubSub.publish("Area:modified",{event:event,item:r})})),this.PubSub.subscribe("Interaction:init",this.start),this.PubSub.subscribe("Interaction:end",this.reset)}return i(e,[{key:"HTMLNode",get:function(){return this._node}},{key:"computedBorder",get:function(){return this._computedBorder?this._computedBorder:{top:parseInt(this.computedStyle.borderTopWidth),bottom:parseInt(this.computedStyle.borderBottomWidth),left:parseInt(this.computedStyle.borderLeftWidth),right:parseInt(this.computedStyle.borderRightWidth)}}},{key:"computedStyle",get:function(){return this._computedStyle?this._computedStyle:this.HTMLNode instanceof HTMLDocument?this._computedStyle=getComputedStyle(this.HTMLNode.body||this.HTMLNode.documentElement):this._computedStyle=getComputedStyle(this.HTMLNode)}},{key:"rect",get:function(){return this._rect?this._rect:this._rect=function(t,e){if(t instanceof Document)return{top:0,left:0,bottom:0,right:0,width:window.innerWidth,height:window.innerHeight};var i=t.getBoundingClientRect();return{top:i.top,left:i.left,bottom:i.bottom,right:i.right,width:(t.clientWidth||i.width)*e,height:(t.clientHeight||i.height)*e}}(this.HTMLNode,this._zoom)}},{key:"parentNodes",get:function(){if(this._parentNodes)return this._parentNodes;return this._parentNodes=function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=null===(i=e[n])||void 0===i?void 0:i.parentNode;return r?(e.push(r),t(e,++n)):e}([this.HTMLNode]),this._parentNodes}}]),e}(),C=function(){function e(i){var r=this,s=i.DS,o=i.useTransform,a=i.dragKeys,l=i.keyboardDragSpeed,c=i.zoom;t(this,e),n(this,"_useTransform",void 0),n(this,"_prevCursorPos",void 0),n(this,"_prevScrollPos",void 0),n(this,"_elements",[]),n(this,"_dragKeys",void 0),n(this,"_dragKeysFlat",void 0),n(this,"_keyboardDragSpeed",void 0),n(this,"_zoom",void 0),n(this,"keyboardDrag",(function(t){var e=t.event,i=t.key;if(r._dragKeysFlat.includes(i)&&r.DS.SelectedSet.size){r._isKeyboard=!0,r.DS.publish("Interaction:start",{event:e,isDragging:!0}),r._elements=r.DS.getSelection(),r.handleZIndex(!0);var n=function(t){var e=t.shiftKey,i=t.keyboardDragSpeed,n=t.zoom,r=t.key,s=t.dragKeys,o=t.scrollDiff,a=t.canScroll,l=t.scrollCallback,c={x:0,y:0},u=e?4*i*n:i*n;return s.left.includes(r)&&(c.x=o.x||-u,e||o.x||!a||l(["left"],i)),s.right.includes(r)&&(c.x=o.x||u,e||o.x||!a||l(["right"],i)),s.up.includes(r)&&(c.y=o.y||-u,e||o.y||!a||l(["top"],i)),s.down.includes(r)&&(c.y=o.y||u,e||o.y||!a||l(["bottom"],i)),c}({shiftKey:r.DS.stores.KeyStore.currentValues.includes("shift"),keyboardDragSpeed:r._keyboardDragSpeed,zoom:r._zoom,key:i,scrollCallback:r.DS.Area.scroll,scrollDiff:r._scrollDiff,canScroll:r.DS.stores.ScrollStore.canScroll,dragKeys:r._dragKeys});r._elements.forEach((function(t){return w({element:t,posDirection:n,containerRect:r.DS.SelectorArea.rect,useTransform:r._useTransform})})),r.DS.publish("Interaction:update",{event:e,isDragging:!0}),r._isKeyboard=!1}})),n(this,"keyboardEnd",(function(t){var e=t.event,i=t.key;r._dragKeysFlat.includes(i)&&r.DS.SelectedSet.size&&(r._isKeyboard=!0,r.DS.publish("Interaction:end",{event:e,isDragging:!0}),r._isKeyboard=!1)})),n(this,"start",(function(t){t.isDragging&&!r._isKeyboard&&(r._prevCursorPos=null,r._prevScrollPos=null,r._elements=r.DS.getSelection(),r.handleZIndex(!0))})),n(this,"stop",(function(){r._isKeyboard||(r._prevCursorPos=null,r._prevScrollPos=null,r.handleZIndex(!1),r._elements=[])})),n(this,"update",(function(t){if(t.isDragging&&r._elements.length&&!r._isKeyboard){var e=m(r._cursorDiff,"+",r._scrollDiff);r._elements.forEach((function(t){return w({element:t,posDirection:e,containerRect:r.DS.SelectorArea.rect,useTransform:r._useTransform})}))}})),n(this,"handleZIndex",(function(t){r._elements.forEach((function(e){return e.style.zIndex="".concat((parseInt(e.style.zIndex)||0)+t?9999:-9998)}))})),this.DS=s,this._useTransform=o,this._keyboardDragSpeed=l,this._zoom=c,this._dragKeys={up:a.up.map((function(t){return t.toLowerCase()})),down:a.down.map((function(t){return t.toLowerCase()})),left:a.left.map((function(t){return t.toLowerCase()})),right:a.right.map((function(t){return t.toLowerCase()}))},this._dragKeysFlat=[].concat(v(this._dragKeys.up),v(this._dragKeys.down),v(this._dragKeys.left),v(this._dragKeys.right)),this.DS.subscribe("Interaction:start",this.start),this.DS.subscribe("Interaction:end",this.stop),this.DS.subscribe("Interaction:update",this.update),this.DS.subscribe("KeyStore:down",this.keyboardDrag),this.DS.subscribe("KeyStore:up",this.keyboardEnd)}return i(e,[{key:"_cursorDiff",get:function(){var t=this.DS.stores.PointerStore.currentVal,e=this._prevCursorPos?m(t,"-",this._prevCursorPos):{x:0,y:0};return this._prevCursorPos=t,e}},{key:"_scrollDiff",get:function(){var t=this.DS.stores.ScrollStore.currentVal,e=this._prevScrollPos?m(t,"-",this._prevScrollPos):{x:0,y:0};return this._prevScrollPos=t,e}}]),e}(),T=function(){function e(i){var r=this,s=i.areaElement,o=i.DS,a=i.draggability,l=i.immediateDrag;t(this,e),n(this,"_areaElement",void 0),n(this,"_draggability",void 0),n(this,"_immediateDrag",void 0),n(this,"isInteracting",void 0),n(this,"isDragging",void 0),n(this,"init",(function(){r.stop(),r._areaElement.addEventListener("mousedown",r.start),r._areaElement.addEventListener("touchstart",r.start,{passive:!1}),r.DS.publish("Interaction:init",{})})),n(this,"start",(function(t){"touchstart"===t.type&&t.preventDefault(),r._canInteract(t)&&(r.isInteracting=!0,r.isDragging=r.isDragEvent(t),r.DS.publish("Interaction:start",{event:t,isDragging:r.isDragging}),document.addEventListener("mouseup",r.reset),document.addEventListener("touchend",r.reset))})),n(this,"isDragEvent",(function(t){return!(!r._draggability||r.DS.stores.KeyStore.isMultiSelectKeyPressed(t)||!r.DS.SelectableSet.has(t.target))&&(r._immediateDrag&&(r.DS.SelectedSet.size?r.DS.SelectedSet.has(t.target)||(r.DS.SelectedSet.clear(),r.DS.SelectedSet.add(t.target)):r.DS.SelectedSet.add(t.target)),!!r.DS.SelectedSet.has(t.target))})),n(this,"onClick",(function(t){var e=t.event;if(r._canInteract(e)&&!(e.detail>0)){var i=r.DS,n=i.stores,s=n.PointerStore,o=n.KeyStore,a=i.SelectableSet,l=i.SelectedSet,c=i.publish;s.start(e);var u=e.target;a.has(u)&&(o.isMultiSelectKeyPressed(e)||l.clear(),l.toggle(u),c("Interaction:end",{event:e,isDragging:r.isDragging}))}})),n(this,"stop",(function(){r.isInteracting=!1,r.isDragging=!1,r._areaElement.removeEventListener("mousedown",r.start),r._areaElement.removeEventListener("touchstart",r.start,{passive:!1}),document.removeEventListener("mouseup",r.reset),document.removeEventListener("touchend",r.reset)})),n(this,"update",(function(t){var e=t.event,i=t.data;r.isInteracting&&r.DS.publish("Interaction:update",{event:e,data:i,isDragging:r.isDragging})})),n(this,"reset",(function(t){var e=r.isDragging;r.stop(),r.init(),r.DS.publish("Interaction:end",{event:t,isDragging:e})})),this._areaElement=s,this._draggability=a,this._immediateDrag=l,this.DS=o,this.DS.subscribe("PointerStore:updated",this.update),this.DS.subscribe("Selectable:click",this.onClick),this.DS.subscribe("Selectable:pointer",(function(t){var e=t.event;return r.start(e)})),this.DS.subscribe("Area:scroll",this.update)}return i(e,[{key:"_canInteract",value:function(t){return!(2===t.button||this.isInteracting||t.target&&!this.DS.SelectorArea.isInside(t.target))}}]),e}(),V=function e(){var i=this;t(this,e),n(this,"subscribers",{}),n(this,"subscribe",(function(t,e){return Array.isArray(i.subscribers[t])||(i.subscribers[t]=[]),i.subscribers[t].push(e),i.subscribers[t].length-1})),n(this,"unsubscribe",(function(t,e,n){n>=0?i.subscribers[t].splice(n,1):e&&(i.subscribers[t]=i.subscribers[t].filter((function(t){return t!==e})))})),n(this,"publish",(function(t,e){Array.isArray(i.subscribers[t])&&i.subscribers[t].forEach((function(t){return t(e)}))}))},N=function(e){r(a,c(Set));var o=h(a);function a(e){var i,r=e.elements,s=e.className,l=e.hoverClassName,c=e.DS;return t(this,a),n(u(i=o.call(this)),"_initElements",void 0),n(u(i),"_className",void 0),n(u(i),"_hoverClassName",void 0),n(u(i),"init",(function(){return i._initElements.forEach((function(t){return i.add(t)}))})),n(u(i),"clear",(function(){return i.forEach((function(t){return i.delete(t)}))})),n(u(i),"_onClick",(function(t){return i.DS.publish("Selectable:click",{event:t})})),n(u(i),"_onPointer",(function(t){return i.DS.publish("Selectable:pointer",{event:t})})),n(u(i),"addAll",(function(t){return t.forEach((function(t){return i.add(t)}))})),n(u(i),"deleteAll",(function(t){return t.forEach((function(t){return i.delete(t)}))})),i.DS=c,i._initElements=A(r),i._className=s,i._hoverClassName=l,i.DS.subscribe("Interaction:init",i.init),i}return i(a,[{key:"add",value:function(t){return t.classList.add(this._className),t.addEventListener("click",this._onClick),t.addEventListener("mousedown",this._onPointer),t.addEventListener("touchstart",this._onPointer,{passive:!1}),f(s(a.prototype),"add",this).call(this,t)}},{key:"delete",value:function(t){return t.classList.remove(this._className),t.classList.remove(this._hoverClassName),t.removeEventListener("click",this._onClick),t.removeEventListener("mousedown",this._onPointer),t.removeEventListener("touchstart",this._onPointer,{passive:!1}),f(s(a.prototype),"delete",this).call(this,t)}},{key:"elements",get:function(){return Array.from(this.values())}}]),a}(),M=function(e){r(a,c(Set));var o=h(a);function a(e){var i,r=e.className,s=e.DS;return t(this,a),n(u(i=o.call(this)),"_className",void 0),n(u(i),"clear",(function(){return i.forEach((function(t){return i.delete(t)}))})),n(u(i),"addAll",(function(t){return t.forEach((function(t){return i.add(t)}))})),n(u(i),"deleteAll",(function(t){return t.forEach((function(t){return i.delete(t)}))})),i.DS=s,i._className=r,i}return i(a,[{key:"add",value:function(t){if(!f(s(a.prototype),"has",this).call(this,t))return f(s(a.prototype),"add",this).call(this,t),t.classList.add(this._className),this.DS.publish("Selected:added",{items:this.elements,item:t}),t.style.zIndex="".concat((parseInt(t.style.zIndex)||0)+1),this}},{key:"delete",value:function(t){if(f(s(a.prototype),"has",this).call(this,t)){var e=f(s(a.prototype),"delete",this).call(this,t);return t.classList.remove(this._className),this.DS.publish("Selected:removed",{items:this.elements,item:t}),t.style.zIndex="".concat((parseInt(t.style.zIndex)||0)-1),e}}},{key:"toggle",value:function(t){return this.has(t)?this.delete(t):this.add(t),t}},{key:"elements",get:function(){return Array.from(this.values())}}]),a}(),K=function(){function e(i){var r=this,s=i.DS,o=i.hoverClassName,a=i.multiSelectToggling;t(this,e),n(this,"_prevSelected",void 0),n(this,"_hoverClassName",void 0),n(this,"_multiSelectToggling",void 0),n(this,"start",(function(t){var e=t.event;t.isDragging||(r._storePrevious(e),r._checkIfInsideSelection(!0,e))})),n(this,"update",(function(t){t.isDragging||r._checkIfInsideSelection()})),n(this,"_checkIfInsideSelection",(function(t,e){for(var i=r.DS,n=i.SelectableSet,s=i.SelectorArea,o=i.Selector,a=n.elements.map((function(t){return[t,t.getBoundingClientRect()]})),l=[],c=[],u=0,d=a.length;u<d;u++)s.isInside(a[u][0],a[u][1])&&(E(a[u][1],o.rect)?l.push(a[u][0]):c.push(a[u][0]));return l.forEach((function(i){return r._handleSelection(i,t,e)})),c.forEach((function(e){return r._handleUnselection(e,t)})),l.length>-1})),this._hoverClassName=o,this._multiSelectToggling=a,this.DS=s,this.DS.subscribe("Interaction:start",this.start),this.DS.subscribe("Interaction:update",this.update)}return i(e,[{key:"_storePrevious",value:function(t){var e=this.DS,i=e.stores.KeyStore,n=e.SelectedSet;i.isMultiSelectKeyPressed(t)?this._prevSelected=new Set(n):this._prevSelected=new Set}},{key:"_handleSelection",value:function(t,e,i){if(t.classList.contains(this._hoverClassName)&&!e)return!1;var n=this.DS,r=n.SelectedSet,s=n.stores.KeyStore;r.has(t)?s.isMultiSelectKeyPressed(i)&&this._multiSelectToggling&&r.delete(t):r.add(t),t.classList.add(this._hoverClassName)}},{key:"_handleUnselection",value:function(t,e){if(t.classList.contains(this._hoverClassName)&&!e)return!1;var i=this.DS.SelectedSet,n=i.has(t),r=this._prevSelected.has(t);n&&!r?i.delete(t):!n&&r&&i.add(t),t.classList.remove(this._hoverClassName)}}]),e}(),z=function(){function e(i){var r=this,s=i.DS,o=i.selector,a=i.selectorClass,l=i.customStyles;t(this,e),n(this,"_rect",void 0),n(this,"start",(function(t){if(!t.isDragging){var e=r.DS.stores.PointerStore.initialValArea;P(r.HTMLNode,g(e,1)),r.HTMLNode.style.display="block",r._rect=null}})),n(this,"stop",(function(){r.HTMLNode.style.width="0",r.HTMLNode.style.height="0",r.HTMLNode.style.display="none"})),n(this,"update",(function(t){if(!t.isDragging){var e=r.DS.stores,i=e.ScrollStore,n=e.PointerStore,s=function(t){var e=t.scrollAmount,i=t.initialPointerPos,n=t.pointerPos,r={};return n.x>i.x-e.x?(r.left=i.x-e.x,r.width=n.x-i.x+e.x):(r.left=n.x,r.width=i.x-n.x-e.x),n.y>i.y-e.y?(r.top=i.y-e.y,r.height=n.y-i.y+e.y):(r.top=n.y,r.height=i.y-n.y-e.y),r}({scrollAmount:i.scrollAmount,initialPointerPos:n.initialValArea,pointerPos:n.currentValArea});P(r.HTMLNode,s),r._rect=null}})),this.DS=s,this.HTMLNode=o||function(t){var e=document.createElement("div");return e.style.position="absolute",t||(e.style.background="rgba(0, 0, 255, 0.1)",e.style.border="1px solid rgba(0, 0, 255, 0.45)",e.style.display="none",e.style.pointerEvents="none"),e}(l),this.HTMLNode.classList.add(a),this.DS.subscribe("Interaction:start",this.start),this.DS.subscribe("Interaction:update",this.update),this.DS.subscribe("Interaction:end",this.stop)}return i(e,[{key:"rect",get:function(){return this._rect?this._rect:this._rect=this.HTMLNode.getBoundingClientRect()}}]),e}(),H=function(){function e(i){var r=this,s=i.DS,o=i.selectorAreaClass,a=i.autoScrollSpeed,l=i.overflowTolerance;t(this,e),n(this,"_autoScrollSpeed",void 0),n(this,"_scrollInterval",void 0),n(this,"_rect",void 0),n(this,"currentEdges",[]),n(this,"_overflowTolerance",void 0),n(this,"updatePos",(function(){r._rect=null;var t=r.DS.Area.rect,e=r.DS.Area.computedBorder,i=r.HTMLNode.style,n="".concat(t.top+e.top,"px"),s="".concat(t.left+e.left,"px"),o="".concat(t.width,"px"),a="".concat(t.height,"px");i.top!==n&&(i.top=n),i.left!==s&&(i.left=s),i.width!==o&&(i.width=o),i.height!==a&&(i.height=a)})),n(this,"startAutoScroll",(function(){r.currentEdges=[],r._scrollInterval=setInterval((function(){return r.handleAutoScroll()}),16)})),n(this,"handleAutoScroll",(function(){var t=r.DS,e=t.stores.PointerStore,i=t.Area;r.currentEdges=_({elementRect:g(e.currentVal),containerRect:r.rect,tolerance:r._overflowTolerance}),r.currentEdges.length&&i.scroll(r.currentEdges,r._autoScrollSpeed)})),n(this,"stopAutoScroll",(function(){r.currentEdges=[],clearInterval(r._scrollInterval)})),n(this,"isInside",(function(t,e){return!(!r.DS.Area.HTMLNode.contains(t)||!r.DS.stores.ScrollStore.canScroll)||E(r.rect,e||t.getBoundingClientRect())})),this._autoScrollSpeed=a,this._overflowTolerance=l,this.DS=s,this.HTMLNode=function(t){var e=document.createElement("div");return e.style.position="fixed",e.style.overflow="hidden",e.style.pointerEvents="none",e.style.zIndex="999999999999999999",e.classList.add(t),e}(o),this.HTMLNode.appendChild(this.DS.Selector.HTMLNode);var c=document.body?"body":"documentElement";document[c].appendChild(this.HTMLNode),this.DS.subscribe("Area:modified",this.updatePos),this.DS.subscribe("Interaction:start",this.startAutoScroll),this.DS.subscribe("Interaction:end",(function(){r.updatePos(),r.stopAutoScroll()}))}return i(e,[{key:"isClicked",value:function(){var t=this.DS.stores.PointerStore;return E({left:t.initialVal.x,top:t.initialVal.y,right:t.initialVal.x,bottom:t.initialVal.y},this.rect)}},{key:"rect",get:function(){return this._rect?this._rect:this._rect=this.HTMLNode.getBoundingClientRect()}}]),e}(),R=function(){function e(i){var r=this,s=i.DS,o=i.multiSelectKeys,a=i.multiSelectMode;t(this,e),n(this,"_multiSelectMode",void 0),n(this,"_multiSelectKeys",void 0),n(this,"_currentValues",new Set),n(this,"_keyMapping",{control:"ctrlKey",shift:"shiftKey",meta:"metaKey"}),n(this,"init",(function(){document.addEventListener("keydown",r.keydown),document.addEventListener("keyup",r.keyup),window.addEventListener("blur",r.reset)})),n(this,"keydown",(function(t){var e=t.key.toLowerCase();r._currentValues.add(e),r.DS.publish("KeyStore:down",{event:t,key:e})})),n(this,"keyup",(function(t){var e=t.key.toLowerCase();r._currentValues.delete(e),r.DS.publish("KeyStore:up",{event:t,key:e})})),n(this,"stop",(function(){document.removeEventListener("keydown",r.keydown),document.removeEventListener("keyup",r.reset),window.removeEventListener("blur",r.reset),r.reset()})),n(this,"reset",(function(){return r._currentValues.clear()})),this.DS=s,this._multiSelectMode=a,this._multiSelectKeys=o.map((function(t){var e={ctrlKey:"Control",shiftKey:"Shift",metaKey:"Meta"}[t];return e?(console.warn("[DragSelect] ".concat(t,' is deprecated. Use "').concat(e,'" instead. Act Now!. See docs for more info')),e.toLowerCase()):t.toLowerCase()})),this.DS.subscribe("Interaction:init",this.init)}return i(e,[{key:"isMultiSelectKeyPressed",value:function(t){var e=this;return!!this._multiSelectMode||(!!this.currentValues.some((function(t){return e._multiSelectKeys.includes(t)}))||!(!t||!this._multiSelectKeys.some((function(i){return t[e._keyMapping[i]]}))))}},{key:"currentValues",get:function(){return Array.from(this._currentValues.values())}}]),e}(),O=function(){function e(i){var r=this,s=i.DS;t(this,e),n(this,"_isMouseInteraction",!1),n(this,"_initialValArea",void 0),n(this,"_currentValArea",void 0),n(this,"_lastValArea",void 0),n(this,"_initialVal",void 0),n(this,"_currentVal",void 0),n(this,"_lastVal",void 0),n(this,"_lastTouch",void 0),n(this,"init",(function(){document.addEventListener("mousemove",r.update),document.addEventListener("touchmove",r.update,{passive:!1})})),n(this,"update",(function(t){t&&(r.currentVal=D({event:r._normalizedEvent(t)}),r._isMouseInteraction&&r.DS.publish("PointerStore:updated",{event:t}))})),n(this,"stop",(function(){document.removeEventListener("mousemove",r.update),document.removeEventListener("touchmove",r.update,{passive:!1}),setTimeout((function(){return r._isMouseInteraction=!1}),100)})),n(this,"reset",(function(t){t&&(r.currentVal=r.lastVal=D({event:r._normalizedEvent(t)}),r.stop(),r.init())})),this.DS=s,this.DS.subscribe("Interaction:init",this.init),this.DS.subscribe("Interaction:start",(function(t){var e=t.event;return r.start(e)})),this.DS.subscribe("Interaction:end",(function(t){var e=t.event;return r.reset(e)}))}return i(e,[{key:"start",value:function(t){t&&(this._isMouseInteraction=!0,this.currentVal=this.initialVal=D({event:this._normalizedEvent(t)}))}},{key:"_normalizedEvent",value:function(t){return"touches"in t&&"touchend"!==t.type&&(this._lastTouch=t),"touches"in t?this._lastTouch.touches[0]:t}},{key:"initialValArea",get:function(){return this._initialValArea?this._initialValArea:{x:0,y:0}}},{key:"currentValArea",get:function(){return this._currentValArea?this._currentValArea:{x:0,y:0}}},{key:"lastValArea",get:function(){return this._lastValArea?this._lastValArea:{x:0,y:0}}},{key:"initialVal",get:function(){return this._initialVal?this._initialVal:{x:0,y:0}},set:function(t){this._initialVal=t,this._initialValArea=t&&m(t,"-",m(p(this.DS.Area.rect),"+",p(this.DS.Area.computedBorder)))}},{key:"currentVal",get:function(){return this._currentVal?this._currentVal:{x:0,y:0}},set:function(t){this._currentVal=t,this._currentValArea=t&&m(t,"-",m(p(this.DS.Area.rect),"+",p(this.DS.Area.computedBorder)))}},{key:"lastVal",get:function(){return this._lastVal?this._lastVal:{x:0,y:0}},set:function(t){this._lastVal=t,this._lastValArea=t&&m(t,"-",m(p(this.DS.Area.rect),"+",p(this.DS.Area.computedBorder)))}}]),e}(),B=function(){function e(i){var r=this,s=i.DS,o=i.areaElement,a=i.zoom;t(this,e),n(this,"_initialVal",void 0),n(this,"_currentVal",void 0),n(this,"_areaElement",void 0),n(this,"_canScroll",void 0),n(this,"init",(function(){return r._areaElement.addEventListener("scroll",r.update)})),n(this,"start",(function(){r._currentVal=r._initialVal=b(r._areaElement),r._areaElement.addEventListener("scroll",r.update)})),n(this,"update",(function(){return r._currentVal=b(r._areaElement)})),n(this,"stop",(function(){r._areaElement.removeEventListener("scroll",r.update),r._initialVal={x:0,y:0},r._canScroll=null})),n(this,"reset",(function(){r.stop(),r.start()})),this._areaElement=o,this.DS=s,this.zoom=a,this.DS.subscribe("Interaction:init",this.init),this.DS.subscribe("Interaction:start",(function(){return r.start()})),this.DS.subscribe("Interaction:end",(function(){return r.reset()}))}return i(e,[{key:"canScroll",get:function(){return"boolean"==typeof this._canScroll?this._canScroll:this._canScroll=(t=this._areaElement,!!((e=b(t)).x||e.y||(t instanceof HTMLDocument?t.body?t.body.scrollTop=1:t.documentElement.scrollTop=1:t.scrollTop=1)));var t,e}},{key:"scrollAmount",get:function(){var t,e=m(this.currentVal,"-",this.initialVal),i={x:t=this.zoom,y:t},n=m(m(e,"*",i),"-",e);return{x:e.x+n.x,y:e.y+n.y}}},{key:"initialVal",get:function(){return this._initialVal?this._initialVal:{x:0,y:0}}},{key:"currentVal",get:function(){return this._currentVal||(this._currentVal=b(this._areaElement)),this._currentVal}}]),e}(),j=function(){function e(i){var r=this,s=i.area,o=void 0===s?document:s,a=i.selectables,l=void 0===a?[]:a,c=i.autoScrollSpeed,u=void 0===c?5:c,d=i.overflowTolerance,h=void 0===d?{x:25,y:25}:d,f=i.zoom,v=void 0===f?1:f,S=i.customStyles,m=void 0!==S&&S,p=i.multiSelectMode,g=void 0!==p&&p,y=i.multiSelectToggling,b=void 0===y||y,_=i.multiSelectKeys,D=void 0===_?["Control","Shift","Meta"]:_,k=i.selector,x=void 0===k?void 0:k,E=i.draggability,w=void 0===E||E,I=i.immediateDrag,A=void 0===I||I,P=i.dragKeys,j=i.keyboardDragSpeed,U=void 0===j?10:j,W=i.useTransform,F=void 0===W||W,Z=i.hoverClass,G=void 0===Z?"ds-hover":Z,X=i.selectableClass,Y=void 0===X?"ds-selectable":X,$=i.selectedClass,q=void 0===$?"ds-selected":$,J=i.selectorClass,Q=void 0===J?"ds-selector":J,tt=i.selectorAreaClass,et=void 0===tt?"ds-selector-area":tt,it=i.callback,nt=i.onDragMove,rt=i.onDragStartBegin,st=i.onDragStart,ot=i.onElementSelect,at=i.onElementUnselect;t(this,e),n(this,"start",(function(){return r.Interaction.init()})),n(this,"getSelection",(function(){return r.SelectedSet.elements})),n(this,"getSelectables",(function(){return r.SelectableSet.elements})),n(this,"getInitialCursorPosition",(function(){return r.stores.PointerStore.initialVal})),n(this,"getCurrentCursorPosition",(function(){return r.stores.PointerStore.currentVal})),n(this,"getPreviousCursorPosition",(function(){return r.stores.PointerStore.lastVal})),n(this,"getInitialCursorPositionArea",(function(){return r.stores.PointerStore.initialValArea})),n(this,"getCurrentCursorPositionArea",(function(){return r.stores.PointerStore.currentValArea})),n(this,"getPreviousCursorPositionArea",(function(){return r.stores.PointerStore.lastValArea})),n(this,"isMultiSelect",(function(t){return r.stores.KeyStore.isMultiSelectKeyPressed(t)})),n(this,"isDragging",(function(){return r.Interaction.isDragging})),this.PubSub=new V,this.subscribe=this.PubSub.subscribe,this.unsubscribe=this.PubSub.unsubscribe,this.publish=this.PubSub.publish,this._callbacksTemp({callback:it,onDragMove:nt,onDragStart:st,onDragStartBegin:rt,onElementSelect:ot,onElementUnselect:at}),this.stores={PointerStore:new O({DS:this}),ScrollStore:new B({DS:this,areaElement:o,zoom:v}),KeyStore:new R({DS:this,multiSelectKeys:D,multiSelectMode:g})},this.Area=new L({area:o,PS:this.PubSub,zoom:v}),this.Selector=new z({DS:this,selector:x,selectorClass:Q,customStyles:m}),this.SelectorArea=new H({DS:this,selectorAreaClass:et,autoScrollSpeed:u,overflowTolerance:h}),this.SelectableSet=new N({elements:l,DS:this,className:Y,hoverClassName:G}),this.SelectedSet=new M({DS:this,className:q}),this.Selection=new K({DS:this,hoverClassName:G,multiSelectToggling:b}),this.Drag=new C({DS:this,useTransform:F,dragKeys:Object.assign({up:["ArrowUp"],down:["ArrowDown"],left:["ArrowLeft"],right:["ArrowRight"]},P),zoom:v,keyboardDragSpeed:U}),this.Interaction=new T({areaElement:o,DS:this,draggability:w,immediateDrag:A}),this.subscribe("Selected:added",(function(t){var e=t.items,i=t.item;return r.publish("elementselect",{items:e,item:i,isDragging:r.Interaction.isDragging})})),this.subscribe("Selected:removed",(function(t){var e=t.items,i=t.item;return r.publish("elementunselect",{items:e,item:i,isDragging:r.Interaction.isDragging})})),this.subscribe("Interaction:update",(function(t){var e=t.event,i=t.data,n=t.isDragging;e&&!i&&r.publish("dragmove",{items:r.getSelection(),event:e,isDragging:n}),!e&&i&&r.publish("autoscroll",{data:i,isDragging:n})})),this.subscribe("Interaction:start",(function(t){var e=t.event,i=t.isDragging;return r.publish("dragstart",{items:r.getSelection(),event:e,isDragging:i})})),this.subscribe("Interaction:end",(function(t){var e=t.event,i=t.isDragging;return r.publish("callback",{items:r.getSelection(),event:e,isDragging:i})})),this.start()}return i(e,[{key:"_callbacksTemp",value:function(t){var e=t.callback,i=t.onDragMove,n=t.onDragStart,r=t.onDragStartBegin,s=t.onElementSelect,o=t.onElementUnselect,a=function(t,e){return console.warn("[DragSelect] ".concat(t,' is deprecated. Use DragSelect.subscribe("').concat(e,'", (callbackObject) => {}) instead. Act Now! See docs for more info'))};e&&(a("callback","callback"),this.subscribe("callback",(function(t){var i=t.items,n=(t.item,t.event);return e(i,n)}))),i&&(a("onDragMove","dragmove"),this.subscribe("dragmove",(function(t){t.items,t.item;var e=t.event;return i(e)}))),n&&(a("onDragStart","dragstart"),this.subscribe("dragstart",(function(t){t.items,t.item;var e=t.event;return n(e)}))),r&&(a("onDragStartBegin","dragstart"),this.subscribe("dragstart",(function(t){t.items,t.item;var e=t.event;return r(e)}))),s&&(a("onElementSelect","elementselect"),this.subscribe("elementselect",(function(t){t.items;var e=t.item,i=t.event;return s(e,i)}))),o&&(a("onElementUnselect","elementunselect"),this.subscribe("elementunselect",(function(t){t.items;var e=t.item,i=t.event;return o(e,i)})))}},{key:"stop",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;i&&this.publish("callback",{items:this.getSelection()}),this.Interaction.stop(),this.Area.stop(),this.Drag.stop(),this.Selector.stop(),this.stores.KeyStore.stop(),this.stores.PointerStore.stop(),this.stores.ScrollStore.stop(),t&&this.SelectableSet.clear(),e&&this.SelectedSet.clear()}},{key:"addSelection",value:function(t,e,i){return this.SelectedSet.addAll(A(t)),i||this.addSelectables(t),e&&this.PubSub.publish("callback",{items:this.getSelection()}),this.getSelection()}},{key:"removeSelection",value:function(t,e,i){return this.SelectedSet.deleteAll(A(t)),i&&this.removeSelectables(t),e&&this.PubSub.publish("callback",{items:this.getSelection()}),this.getSelection()}},{key:"toggleSelection",value:function(t,e,i){var n=this;return A(t).forEach((function(r){return n.SelectedSet.has(r)?n.removeSelection(t,e,i):n.addSelection(t,e,i)})),e&&this.PubSub.publish("callback",{items:this.getSelection()}),this.getSelection()}},{key:"setSelection",value:function(t,e,i){return this.clearSelection(),this.addSelection(t,e,i),this.getSelection()}},{key:"clearSelection",value:function(t){return this.SelectedSet.clear(),t&&this.PubSub.publish("callback",{items:this.getSelection()}),this.getSelection()}},{key:"addSelectables",value:function(t,e){var i=A(t);return this.SelectableSet.addAll(i),e&&this.SelectedSet.addAll(i),t}},{key:"setSelectables",value:function(t,e,i){return this.removeSelectables(t,e),this.addSelectables(t,i)}},{key:"removeSelectables",value:function(t,e){return this.SelectedSet.clear(),e&&this.SelectedSet.clear(),t}},{key:"getCursorPositionDifference",value:function(t){var e=this.getCurrentCursorPosition(),i=t?this.getPreviousCursorPosition():this.getInitialCursorPosition();return m(e,"-",i)}}]),e}();export default j;