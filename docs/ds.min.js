!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).DragSelect=t()}(this,(function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function i(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(e);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return o(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,i=new Array(t);s<t;s++)i[s]=e[s];return i}return console.log(),function(){function o(e){var t=this,i=e.area,l=void 0===i?document:i,r=e.autoScrollSpeed,n=void 0===r?1:r,a=e.callback,c=void 0===a?function(){}:a,h=e.customStyles,u=void 0!==h&&h,d=e.hoverClass,v=void 0===d?"ds-hover":d,f=e.multiSelectKeys,y=void 0===f?["ctrlKey","shiftKey","metaKey"]:f,_=e.multiSelectMode,m=void 0!==_&&_,S=e.onDragMove,g=void 0===S?function(){}:S,p=e.onDragStart,b=void 0===p?function(){}:p,k=e.onDragStartBegin,C=void 0===k?function(){}:k,x=e.onElementSelect,P=void 0===x?function(){}:x,w=e.onElementUnselect,E=void 0===w?function(){}:w,L=e.selectableClass,I=void 0===L?"ds-selectable":L,T=e.selectables,A=void 0===T?[]:T,O=e.selectedClass,M=void 0===O?"ds-selected":O,K=e.selector,U=void 0===K?void 0:K,R=e.selectorClass,j=void 0===R?"ds-selector":R,D=e.zoom,z=void 0===D?1:D;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),s(this,"_multiSelectKeyPressed",!1),s(this,"_initialCursorPos",{x:0,y:0}),s(this,"_newCursorPos",{x:0,y:0}),s(this,"_previousCursorPos",{x:0,y:0}),s(this,"_initialScroll",{x:0,y:0}),s(this,"_selected",[]),s(this,"_prevSelected",[]),s(this,"_lastTouch",void 0),s(this,"_autoScrollInterval",null),s(this,"_onClick",(function(e){return t.handleClick(e)})),s(this,"_startUp",(function(e){return t.startUp(e)})),s(this,"_handleMove",(function(e){return t.handleMove(e)})),s(this,"_end",(function(e){return t.reset(e,!0)})),this.selectedClass=M,this.hoverClass=v,this.selectorClass=j,this.selectableClass=I,this.selectables=[],this._initialSelectables=this._toArray(A),this.multiSelectKeys=y,this.multiSelectMode=m,this.autoScrollSpeed=0===n?0:n,this.selectCallback=P,this.unselectCallback=E,this.onDragStartBegin=C,this.moveStartCallback=b,this.moveCallback=g,this.callback=c,this.area=this._handleArea(l),this.customStyles=u,this.zoom=z,this.selector=U||this._createSelector(),this.selector.classList.add(this.selectorClass),this.start()}var l,r,n;return l=o,(r=[{key:"_handleArea",value:function(e){if(e===document)return e;var t=getComputedStyle(e);e.computedBorder=parseInt(t.borderWidth);var s=t.position;return"absolute"===s||"relative"===s||"fixed"===s||(e.style.position="relative"),e}},{key:"_handleSelectables",value:function(e,t,s){for(var i=0;i<e.length;i++){var o=e[i],l=this.selectables.indexOf(o);l<0&&!t?this._addSelectable(o,s):l>-1&&t&&this._removeSelectable(o,l,s)}}},{key:"_addSelectable",value:function(e,t){e.classList.add(this.selectableClass),e.addEventListener("click",this._onClick),this.selectables.push(e),t&&this._selected.indexOf(e)<0&&(e.classList.add(this.selectedClass),this._selected.push(e))}},{key:"_removeSelectable",value:function(e,t,s){e.classList.remove(this.hoverClass),e.classList.remove(this.selectableClass),e.removeEventListener("click",this._onClick),this.selectables.splice(t,1),s&&this._selected.indexOf(e)>-1&&(e.classList.remove(this.selectedClass),this._selected.splice(this._selected.indexOf(e),1))}},{key:"handleClick",value:function(e){if(!this.mouseInteraction&&!this._isRightClick(e)){var t=e.target;this._isMultiSelectKeyPressed(e)?this._prevSelected=this._selected.slice():this._prevSelected=[],this.checkIfInsideSelection(!0),this.selectables.indexOf(t)>-1&&this.toggle(t),this._end(e)}}},{key:"_createSelector",value:function(){var e=document.createElement("div");return e.style.position="absolute",this.customStyles||(e.style.background="rgba(0, 0, 255, 0.1)",e.style.border="1px solid rgba(0, 0, 255, 0.45)",e.style.display="none",e.style.pointerEvents="none"),(this.area===document?document.body:this.area).appendChild(e),e}},{key:"start",value:function(){this._handleSelectables(this._initialSelectables),this.area.addEventListener("mousedown",this._startUp),this.area.addEventListener("touchstart",this._startUp,{passive:!1})}},{key:"startUp",value:function(e){if("touchstart"===e.type&&e.preventDefault(),!this._isRightClick(e)&&!this._isScrollbarClick(e,this.area)){if(this.onDragStartBegin(e),this._breaked)return!1;if(this.mouseInteraction=!0,this.selector.style.display="block",this._isMultiSelectKeyPressed(e)?this._prevSelected=this._selected.slice():this._prevSelected=[],this._getStartingPositions(e),this.checkIfInsideSelection(!0),this.selector.style.display="none",this.moveStartCallback(e),this._breaked)return!1;this.area.removeEventListener("mousedown",this._startUp),this.area.removeEventListener("touchstart",this._startUp,{passive:!1}),this.area.addEventListener("mousemove",this._handleMove),this.area.addEventListener("touchmove",this._handleMove,{passive:!1}),document.addEventListener("mouseup",this._end),document.addEventListener("touchend",this._end)}}},{key:"_isMultiSelectKeyPressed",value:function(e){if(this._multiSelectKeyPressed=!1,this.multiSelectMode)this._multiSelectKeyPressed=!0;else for(var t=0;t<this.multiSelectKeys.length;t++)e[this.multiSelectKeys[t]]&&(this._multiSelectKeyPressed=!0);return this._multiSelectKeyPressed}},{key:"_getStartingPositions",value:function(e){this._initialCursorPos=this._newCursorPos=this._getCursorPos(this.area,e),this._initialScroll=this.getScroll(this.area);var t={};t.x=this._initialCursorPos.x+this._initialScroll.x,t.y=this._initialCursorPos.y+this._initialScroll.y,t.w=0,t.h=0,this._updatePos(this.selector,t)}},{key:"handleMove",value:function(e){var t=this._getPosition(e);if(this.moveCallback(e),this._breaked)return!1;this.selector.style.display="block",this._updatePos(this.selector,t),this.checkIfInsideSelection(null),this._setScrollState(e)}},{key:"_getPosition",value:function(e){var t=this._getCursorPos(this.area,e),s=this.getScroll(this.area);this._newCursorPos=t;var i=s.x-this._initialScroll.x,o=s.y-this._initialScroll.y,l={};return t.x>this._initialCursorPos.x-i?(l.x=this._initialCursorPos.x+this._initialScroll.x,l.w=t.x-this._initialCursorPos.x+i):(l.x=t.x+s.x,l.w=this._initialCursorPos.x-t.x-i),t.y>this._initialCursorPos.y-o?(l.y=this._initialCursorPos.y+this._initialScroll.y,l.h=t.y-this._initialCursorPos.y+o):(l.y=t.y+s.y,l.h=this._initialCursorPos.y-t.y-o),l}},{key:"checkIfInsideSelection",value:function(e){for(var t=!1,s=0,i=this.selectables.length;s<i;s++){var o=this.selectables[s],l=this.getScroll(this.area),r={y:this.selector.getBoundingClientRect().top/this.zoom+l.y,x:this.selector.getBoundingClientRect().left/this.zoom+l.x,h:this.selector.offsetHeight,w:this.selector.offsetWidth};this._isElementTouching(o,r,l)?(this._handleSelection(o,e),t=!0):this._handleUnselection(o,e)}return t}},{key:"_handleSelection",value:function(e,t){if(e.classList.contains(this.hoverClass)&&!t)return!1;var s=this._selected.indexOf(e);s<0?this.select(e):s>-1&&this._multiSelectKeyPressed&&this.unselect(e),e.classList.add(this.hoverClass)}},{key:"_handleUnselection",value:function(e,t){if(!e.classList.contains(this.hoverClass)&&!t)return!1;var s=this._selected.indexOf(e),i=this._prevSelected.indexOf(e);s>-1&&i<0?this.unselect(e):s<0&&i>-1&&this.select(e),e.classList.remove(this.hoverClass)}},{key:"select",value:function(e){return!(this._selected.indexOf(e)>-1)&&(this._selected.push(e),e.classList.add(this.selectedClass),this.selectCallback(e),!this._breaked&&e)}},{key:"unselect",value:function(e){return!(this._selected.indexOf(e)<0)&&(this._selected.splice(this._selected.indexOf(e),1),e.classList.remove(this.selectedClass),this.unselectCallback(e),!this._breaked&&e)}},{key:"toggle",value:function(e){return this._selected.indexOf(e)>-1?this.unselect(e):this.select(e),e}},{key:"_isElementTouching",value:function(e,t,s){var i=e.getBoundingClientRect(),o=i.top/this.zoom+s.y,l=i.left/this.zoom+s.x,r=i.height/this.zoom,n=i.width/this.zoom;return t.x<l+n&&t.x+t.w>l&&t.y<o+r&&t.h+t.y>o}},{key:"_setScrollState",value:function(e){var t=this,s=this.isCursorNearEdge(this.area,e);s?(this._autoScrollInterval&&window.clearInterval(this._autoScrollInterval),this._autoScrollInterval=window.setInterval((function(){t._updatePos(t.selector,t._getPosition(e)),t.checkIfInsideSelection(null),t._autoScroll(s)}))):!s&&this._autoScrollInterval&&(window.clearInterval(this._autoScrollInterval),this._autoScrollInterval=null)}},{key:"_autoScroll",value:function(e){var t=document&&document.documentElement&&document.documentElement.scrollTop&&document.documentElement,s=this.area===document?t||document.body:this.area;"top"===e&&s.scrollTop>0?s.scrollTop-=1*this.autoScrollSpeed:"bottom"===e?s.scrollTop+=1*this.autoScrollSpeed:"left"===e&&s.scrollLeft>0?s.scrollLeft-=1*this.autoScrollSpeed:"right"===e&&(s.scrollLeft+=1*this.autoScrollSpeed)}},{key:"isCursorNearEdge",value:function(t,s){if("object"===e(t)&&this._isElement(s)){console.warn("[DragSelect] DEPRECATION warning: this method signature is changing. From isCursorNearEdge(event, area) to isCursorNearEdge(area, event). Please use area as first argument and event as second. It will still work for now but functionality be removed soon");var i=t;t=s,s=i}var o=this._getCursorPos(t,s),l=this.getAreaRect(t),r=Math.max(l.width/10,30),n=Math.max(l.height/10,30);return o.y<n?"top":l.height-o.y<n?"bottom":l.width-o.x<r?"right":o.x<r&&"left"}},{key:"reset",value:function(e,t){var s=this;if(this._previousCursorPos=this._getCursorPos(this.area,e),document.removeEventListener("mouseup",this._end),document.removeEventListener("touchend",this._end),this.area.removeEventListener("mousemove",this._handleMove),this.area.removeEventListener("touchmove",this._handleMove,{passive:!1}),this.area.addEventListener("mousedown",this._startUp),this.area.addEventListener("touchstart",this._startUp,{passive:!1}),t&&this.callback(this.getSelection(),e),this._breaked)return!1;this.selector.style.width="0",this.selector.style.height="0",this.selector.style.display="none",this._autoScrollInterval&&(window.clearInterval(this._autoScrollInterval),this._autoScrollInterval=null),setTimeout((function(){return s.mouseInteraction=!1}),100)}},{key:"break",value:function(){var e=this;this._breaked=!0,setTimeout((function(){return e._breaked=!1}),100)}},{key:"stop",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2?arguments[2]:void 0;this.reset(!1,s),this.area.removeEventListener("mousedown",this._startUp),this.area.removeEventListener("touchstart",this._startUp,{passive:!1}),document.removeEventListener("mouseup",this._end),document.removeEventListener("touchend",this._end),this._handleSelectables(i(this.selectables),e,t)}},{key:"getSelection",value:function(){return i(this._selected)}},{key:"getCursorPos",value:function(e,t,s){if(!e)return{x:0,y:0};var i=t||!1!==t&&this.area,o=this._getCursorPos(i,e),l=s?{x:0,y:0}:this.getScroll(i);return{x:o.x+l.x,y:o.y+l.y}}},{key:"addSelection",value:function(e,t,s){for(var i=this._toArray(e),o=0,l=i.length;o<l;o++){var r=i[o];this.select(r)}return s||this.addSelectables(i),t&&this.callback(this._selected),this._selected}},{key:"removeSelection",value:function(e,t,s){for(var i=this._toArray(e),o=0,l=i.length;o<l;o++){var r=i[o];this.unselect(r)}return s&&this.removeSelectables(i),t&&this.callback(this._selected),this._selected}},{key:"toggleSelection",value:function(e,t,s){for(var i=this._toArray(e),o=0,l=i.length;o<l;o++){var r=i[o];this._selected.indexOf(r)<0?this.addSelection(r,t,s):this.removeSelection(r,t,s)}return this._selected}},{key:"setSelection",value:function(e,t,s){return this.clearSelection(),this.addSelection(e,t,s),this._selected}},{key:"clearSelection",value:function(e){for(var t=this._selected.slice(),s=0,i=t.length;s<i;s++){var o=t[s];this.unselect(o)}return e&&this.callback(this._selected),this._selected}},{key:"addSelectables",value:function(e,t){var s=this._toArray(e);return this._handleSelectables(s,!1,t),e}},{key:"getSelectables",value:function(){return this.selectables}},{key:"setSelectables",value:function(e,t,s){return this.removeSelectables(this.getSelectables(),t),this.addSelectables(e,s)}},{key:"removeSelectables",value:function(e,t){var s=this._toArray(e);return this._handleSelectables(s,!0,t),e}},{key:"_isRightClick",value:function(e){var t=!1;return"which"in e?t=3===e.which:"button"in e&&(t=2===e.button),t}},{key:"_isScrollbarClick",value:function(e,t){var s=this._getCursorPos(t,e),i=this.getAreaRect(t),o=t.computedBorder||0;return i.width+o<=s.x||i.height+o<=s.y}},{key:"_toArray",value:function(e){if(!e)return[];if(!e.length&&this._isElement(e))return[e];for(var t=[],s=e.length-1;s>=0;s--)t[s]=e[s];return t}},{key:"_isElement",value:function(t){try{return t instanceof HTMLElement||t instanceof SVGElement}catch(s){return"object"===e(t)&&1===t.nodeType&&"object"===e(t.style)&&"object"===e(t.ownerDocument)}}},{key:"_getCursorPos",value:function(e,t){if(!t)return{x:0,y:0};"touches"in t&&"touchend"!==t.type&&(this._lastTouch=t);var s=(t="touches"in t?this._lastTouch.touches[0]:t).pageX||t.clientX,i=t.pageY||t.clientY,o=this.getAreaRect(e||document),l=this.getScroll();return{x:(s-o.left-l.x)/this.zoom,y:(i-o.top-l.y)/this.zoom}}},{key:"getInitialCursorPosition",value:function(){return this._initialCursorPos}},{key:"getCurrentCursorPosition",value:function(){return this._newCursorPos}},{key:"getPreviousCursorPosition",value:function(){return this._previousCursorPos}},{key:"getCursorPositionDifference",value:function(e){var t=this.getCurrentCursorPosition(),s=e?this.getPreviousCursorPosition():this.getInitialCursorPosition();return{x:t.x-s.x,y:t.y-s.y}}},{key:"getScroll",value:function(e){var t={top:document.body.scrollTop>0?document.body.scrollTop:document.documentElement.scrollTop,left:document.body.scrollLeft>0?document.body.scrollLeft:document.documentElement.scrollLeft};return{y:e&&e.scrollTop>=0?e.scrollTop:t.top,x:e&&e.scrollLeft>=0?e.scrollLeft:t.left}}},{key:"getAreaRect",value:function(e){if(e===document){var t={y:e.documentElement.clientHeight>0?e.documentElement.clientHeight:window.innerHeight,x:e.documentElement.clientWidth>0?e.documentElement.clientWidth:window.innerWidth};return{top:0,left:0,bottom:0,right:0,width:t.x,height:t.y}}var s=e.getBoundingClientRect();return{top:s.top,left:s.left,bottom:s.bottom,right:s.right,width:e.clientWidth||s.width,height:e.clientHeight||s.height}}},{key:"_updatePos",value:function(e,t){return e.style.left=t.x+"px",e.style.top=t.y+"px",e.style.width=t.w+"px",e.style.height=t.h+"px",e}}])&&t(l.prototype,r),n&&t(l,n),o}()}));